<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>JLS UPI QR Payment</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  
  <!-- QRious for QR generation -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrious/4.0.2/qrious.min.js" defer></script>

  <style>
    * {
      box-sizing: border-box;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }
    body {
      margin: 0;
      padding: 16px;
      background: #ffffff;
      color: #222;
    }
    h1 {
      margin-top: 0;
      font-size: 20px;
      text-align: center;
    }
    .layout {
      display: flex;
      gap: 16px;
      align-items: flex-start;
      justify-content: center;
      max-width: 1200px;
      margin: 0 auto;
    }
    .panel {
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 16px;
      flex: 1;
      min-width: 320px;
    }
    label {
      font-size: 13px;
      margin-bottom: 4px;
      display: block;
    }
    input {
      width: 100%;
      padding: 6px 8px;
      margin-bottom: 10px;
      border-radius: 4px;
      border: 1px solid #ccc;
      font-size: 14px;
    }
    button {
      padding: 8px 14px;
      border-radius: 6px;
      border: none;
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
    }
    .btn-primary { background: #0052cc; color: #fff; }
    .btn-success { background: #1aa34a; color: #fff; }
    .btn-fail { background: #d93025; color: #fff; }

    .btn-row {
      display: flex;
      gap: 12px;
      justify-content: center;
      margin-top: 12px;
    }

    .qr-wrapper {
      text-align: center;
      padding: 12px;
      border-radius: 8px;
      background: #fafafa;
      border: 1px dashed #ccc;
      min-height: 260px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }

    #qrCanvas { margin-bottom: 8px; }

    .status { font-weight: 600; margin-top: 8px; font-size: 14px; }
    .status.pending { color: #0066cc; }
    .status.paid { color: #0f9d58; }
    .status.cancelled { color: #d93025; }

    #successImage {
      width: 220px;
      display: none;
      margin-top: 12px;
    }

    @media (max-width: 768px) {
      .layout { flex-direction: column; }
    }
  </style>
</head>

<body>
  <h1>JLS – UPI QR Payment</h1>

  <div class="layout">

    <!-- Left Panel -->
    <div class="panel">
      <h2>Step 1 – Enter Billing Details</h2>

      <label>Company line from Busy</label>
      <input id="companyRaw" placeholder="Paste Busy line or type J / C" />

      <label>Invoice / Vch. No.</label>
      <input id="invoiceNo" placeholder="26213" />

      <label>Amount (₹)</label>
      <input id="amount" type="number" placeholder="90" />

      <button id="generateBtn" class="btn-primary">Generate QR</button>
    </div>

    <!-- Right Panel -->
    <div class="panel">
      <h2>Step 2 – Show QR to Customer</h2>

      <div id="qrArea" class="qr-wrapper">
        <div id="idleMsg" style="font-size:18px;color:#777;">Waiting for QR…</div>

        <canvas id="qrCanvas" style="display:none;"></canvas>

        <img id="successImage" 
             src="https://raw.githubusercontent.com/kgangola/jls-qr-payment/main/image.png" />

        <div id="paymentDetails" style="display:none; font-size:14px;"></div>
        <div id="statusText" class="status" style="display:none;"></div>
      </div>

      <div class="btn-row">
        <button id="successBtn" class="btn-success" disabled>SUCCESS</button>
        <button id="failBtn" class="btn-fail" disabled>FAILURE</button>
      </div>
    </div>

  </div>

<script>
const COMPANY_TO_VPA = {
  "JLS TRADING CO": "paytmqr2810050501011pn54jpiri49@paytm",
  "JIWAN LAL SAH GANGOLA & SONS": "paytmqr2810050501011ni90w28cwja@paytm"
};

let qr;
let currentPayment = null;

function normalizeCompany(raw) {
  if (!raw) return "";

  raw = raw.trim().toUpperCase();

  // Shortcuts
  if (raw === "J") return "JLS TRADING CO";
  if (raw === "C") return "JIWAN LAL SAH GANGOLA & SONS";

  // Busy line cleanup
  let clean = raw.split("(")[0].replace(/\./g, "").trim();
  return clean;
}

function getVPA(company) {
  return COMPANY_TO_VPA[company] || null;
}

function showIdle() {
  document.getElementById("idleMsg").style.display = "block";
  document.getElementById("qrCanvas").style.display = "none";
  document.getElementById("successImage").style.display = "none";
  document.getElementById("paymentDetails").style.display = "none";
  document.getElementById("statusText").style.display = "none";
  currentPayment = null;

  successBtn.disabled = true;
  failBtn.disabled = true;
}

// Generate QR
generateBtn.onclick = () => {
  if (currentPayment) {
    alert("A QR is already active. Click SUCCESS or FAILURE first.");
    return;
  }

  let raw = companyRaw.value.trim();
  let invoice = invoiceNo.value.trim();
  let amount = amount.value.trim();

  if (!raw || !invoice || !amount) {
    alert("Please fill all fields.");
    return;
  }

  let company = normalizeCompany(raw);
  let vpa = getVPA(company);

  if (!vpa) {
    alert("Unknown company. Use J or C shortcut, or correct Busy line.");
    return;
  }

  let upiString = `upi://pay?pa=${vpa}&pn=${encodeURIComponent(company)}&am=${amount}&cu=INR`;

  qr.value = upiString;
  currentPayment = { invoice, amount, company };

  document.getElementById("idleMsg").style.display = "none";
  document.getElementById("qrCanvas").style.display = "block";

  paymentDetails.style.display = "block";
  paymentDetails.innerHTML =
    `Invoice: <b>${invoice}</b><br>
     Company: <b>${company}</b><br>
     Amount: <b>₹ ${amount}</b>`;

  statusText.style.display = "block";
  statusText.textContent = "Status: Soundbox Announcement";
  statusText.className = "status pending";

  successBtn.disabled = false;
  failBtn.disabled = false;
};

// Success
successBtn.onclick = () => {
  if (!currentPayment) return;

  qrCanvas.style.display = "none";
  successImage.style.display = "block";

  statusText.textContent = "Status: PAYMENT RECEIVED";
  statusText.className = "status paid";

  setTimeout(showIdle, 900);
};

// Failure
failBtn.onclick = () => {
  if (!currentPayment) return;

  statusText.textContent = "Status: PAYMENT FAILED";
  statusText.className = "status cancelled";

  setTimeout(showIdle, 900);
};

// Init QR
window.onload = () => {
  qr = new QRious({
    element: document.getElementById("qrCanvas"),
    size: 220,
    value: ""
  });
  showIdle();
};
</script>
</body>
</html>
