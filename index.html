; JLS QR Phase 2 - Skeleton
; Hotkey: F9 → read Busy → open QR page with params

#SingleInstance Force
SetTitleMatchMode, 2   ; partial title match

; Adjust this to match your Busy window title text
BUSY_WINDOW_TITLE := "BUSY"

; Base URL of your QR page
QR_BASE_URL := "https://kgangola.github.io/jls-qr-payment/index.html"

F9::
    ; 1) Activate Busy window
    WinActivate, %BUSY_WINDOW_TITLE%
    WinWaitActive, %BUSY_WINDOW_TITLE%,, 1
    if ErrorLevel {
        MsgBox, 16, Error, Could not find Busy window.
        return
    }

    ; 2) TODO: capture regions / OCR for:
    ;    - companyText
    ;    - invoiceText
    ;    - amountText
    ;
    ; For now we'll just use dummy values so you can see the URL behavior.
    ;
    companyText := "J"          ; later: OCR result for company ("J", "C", or full name)
    invoiceText := "26213"      ; later: OCR from Busy
    amountText  := "90.00"      ; later: OCR from Busy

    ; 3) URL encode (simple, no spaces in our fields)
    companyParam := companyText
    invoiceParam := invoiceText
    amountParam  := amountText

    finalUrl := QR_BASE_URL . "?company=" . companyParam . "&invoice=" . invoiceParam . "&amount=" . amountParam

    ; 4) Open in default browser
    Run, %finalUrl%
return