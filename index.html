<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>JLS – UPI QR Payment</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- QR Library -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrious/4.0.2/qrious.min.js" defer></script>

  <style>
    * {
      box-sizing: border-box;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }
    body { margin: 0; padding: 16px; background: #fff; }
    h1 { text-align: center; font-size: 20px; margin-top: 0; }

    .layout {
      display: flex; gap: 16px; justify-content: center; max-width: 1200px; margin: 0 auto;
    }
    .panel {
      border: 1px solid #ddd; border-radius: 8px; padding: 16px; flex: 1; min-width: 320px;
    }
    .panel h2 { margin-top: 0; font-size: 16px; }

    label { font-size: 13px; display: block; margin-bottom: 4px; }
    input {
      width: 100%; padding: 6px 8px; border-radius: 4px; border: 1px solid #ccc; margin-bottom: 10px;
    }

    button {
      padding: 8px 14px; border-radius: 6px; border: none;
      font-size: 14px; font-weight: 600; cursor: pointer;
    }
    .btn-primary { background: #0052cc; color: #fff; }
    .btn-success { background: #1aa34a; color: #fff; }
    .btn-fail { background: #d93025; color: #fff; }

    .btn-row {
      display: flex; gap: 12px; justify-content: center; margin-top: 12px;
    }

    .qr-wrapper {
      text-align: center; padding: 12px; border-radius: 8px;
      background: #fafafa; border: 1px dashed #ccc;
      min-height: 260px; display: flex; flex-direction: column;
      justify-content: center; align-items: center;
    }

    #successImage {
      width: 220px; display: none; margin-top: 10px;
    }

    .status { margin-top: 8px; font-weight: 600; }
    .pending { color: #0066cc; }
    .paid { color: #1aa34a; }
    .cancelled { color: #d93025; }

    .idle { font-size: 18px; color: #777; }

    @media (max-width: 768px) { .layout { flex-direction: column; } }
  </style>
</head>

<body>

<h1>JLS – UPI QR Payment</h1>

<div class="layout">

  <!-- LEFT FORM -->
  <div class="panel">
    <h2>Step 1 – Enter Billing Details</h2>

    <label>Company line from Busy or type J/C</label>
    <input id="companyRaw" placeholder="JLS Trading Co. (2025-26) (COMP0005) or J / C" />

    <label>Invoice / Vch. No.</label>
    <input id="invoiceNo" placeholder="26213" />

    <label>Amount (₹)</label>
    <input id="amount" type="number" placeholder="90" />

    <button id="generateBtn" class="btn-primary">Generate QR</button>
  </div>

  <!-- RIGHT PANEL -->
  <div class="panel">
    <h2>Step 2 – Show QR to Customer</h2>

    <div class="qr-wrapper" id="qrArea">

      <div id="idleMsg" class="idle">Waiting for QR…</div>

      <canvas id="qrCanvas" style="display:none;"></canvas>

      <img id="successImage"
           src="https://raw.githubusercontent.com/kgangola/jls-qr-payment/main/image.png" />

      <div id="paymentDetails" style="display:none; font-size:14px;"></div>

      <div id="statusText" style="display:none;" class="status"></div>
    </div>

    <div class="btn-row">
      <button id="successBtn" class="btn-success" disabled>SUCCESS</button>
      <button id="failBtn" class="btn-fail" disabled>FAILURE</button>
    </div>

  </div>
</div>

<script>
// --------------------------
// COMPANY → VPA MAPPING
// --------------------------
const COMPANY_TO_VPA = {
  "JLS TRADING CO": "paytmqr2810050501011pn54jpiri49@paytm",
  "JIWAN LAL SAH GANGOLA & SONS": "paytmqr2810050501011ni90w28cwja@paytm"
};

let qr;
let currentPayment = null;

// --------------------------------------------------------------
// NORMALIZATION (Busy line OR shortcut J / C)
// --------------------------------------------------------------
function normalizeCompany(raw) {
  if (!raw) return "";

  raw = raw.trim().toUpperCase();

  // Shortcuts
  if (raw === "J") return "JLS TRADING CO";
  if (raw === "C") return "JIWAN LAL SAH GANGOLA & SONS";

  // Remove everything after "("
  if (raw.includes("(")) raw = raw.split("(")[0].trim();

  return raw.replace(/\./g, "").trim();
}

function getVPA(name) {
  return COMPANY_TO_VPA[name] || null;
}

// --------------------------------------------------------------
// RESET UI
// --------------------------------------------------------------
function showIdle() {
  currentPayment = null;

  idleMsg.style.display = "block";
  qrCanvas.style.display = "none";
  successImage.style.display = "none";
  paymentDetails.style.display = "none";
  statusText.style.display = "none";

  successBtn.disabled = true;
  failBtn.disabled = true;
}

// --------------------------------------------------------------
// GENERATE QR
// --------------------------------------------------------------
generateBtn.onclick = () => {
  if (currentPayment) {
    alert("A QR is active. Press SUCCESS or FAILURE first.");
    return;
  }

  let raw = companyRaw.value.trim();
  let invoice = invoiceNo.value.trim();
  let amountVal = amount.value.trim();

  if (!raw || !invoice || !amountVal) {
    alert("Fill all fields.");
    return;
  }

  let company = normalizeCompany(raw);
  let vpa = getVPA(company);

  if (!vpa) {
    alert("Unknown company. Use J / C or a correct Busy line.");
    return;
  }

  let upiString =
    `upi://pay?pa=${vpa}&pn=${encodeURIComponent(company)}&am=${amountVal}&cu=INR`;

  qr.value = upiString;

  currentPayment = { invoice, amountVal, company };

  idleMsg.style.display = "none";
  qrCanvas.style.display = "block";

  paymentDetails.style.display = "block";
  paymentDetails.innerHTML =
    `Invoice: <b>${invoice}</b><br>
     Company: <b>${company}</b><br>
     Amount: <b>₹ ${amountVal}</b>`;

  statusText.style.display = "block";
  statusText.textContent = "Status: Soundbox Announcement";
  statusText.className = "status pending";

  successBtn.disabled = false;
  failBtn.disabled = false;
};

// --------------------------------------------------------------
// SUCCESS
// --------------------------------------------------------------
successBtn.onclick = () => {
  if (!currentPayment) return;

  qrCanvas.style.display = "none";
  successImage.style.display = "block";

  statusText.textContent = "Status: PAYMENT RECEIVED";
  statusText.className = "status paid";

  setTimeout(showIdle, 900);
};

// --------------------------------------------------------------
// FAILURE
// --------------------------------------------------------------
failBtn.onclick = () => {
  if (!currentPayment) return;

  statusText.textContent = "Status: PAYMENT FAILED";
  statusText.className = "status cancelled";

  setTimeout(showIdle, 900);
};

// --------------------------------------------------------------
// INIT QRIOUS
// --------------------------------------------------------------
window.onload = () => {
  qr = new QRious({
    element: document.getElementById("qrCanvas"),
    size: 220,
    value: ""
  });

  showIdle();
};
</script>

</body>
</html>
